package pentest

import (
	"fmt"
	"strings"
)

func GeneralXSS(target string, ignoring bool) bool {
	if !ignoring {
		return false
	}

	fmt.Println("Ignoring non 200 HTTP Response of the target.")

	payload, payloaderror := ReadPayload("pentest/payload/xss.txt")
	if payloaderror != nil {
		fmt.Printf("Error reading payload file: %s\n", payloaderror)
		return false
	}

	// set target
	for idx, line := range payload {
		if strings.Contains(line, "{Target}") {
			payload[idx] = strings.ReplaceAll(line, "{Target}", target)
		}
	}

	fmt.Println("Start XSS")
	foundOrNot := false

	// start attacking
	for _, trial := range payload {
		URL := target + trial
		if SendingRequest(URL) {
			foundOrNot = true
			fmt.Printf("Attack Success: %s\n", URL)
		}
	}

	if foundOrNot {
		fmt.Printf("ğŸª² Found Reflected XSS bug")
	}
	fmt.Printf("âŒ Reflected XSS bug not found")

	return foundOrNot
}
